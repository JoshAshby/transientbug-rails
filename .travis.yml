dist: trusty
sudo: false

language: ruby
rvm:
  - 2.4.1

nvm:
  - 8.3.0

addons:
  chrome: stable

services:
  - postgresql
  - redis-server

# only build pushes to master, force build branches and PRs
branches:
  only:
    - master
    - /force-build$/ # allow for developers to force CI builds if required before PR

cache:
  bundler: true
  yarn: true
  directories:
    - node_modules

matrix:
  fast_finish: true

env:
  global:
    - ES_VERSION=5.5.1
    - ES_DOWNLOAD_URL=https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-${ES_VERSION}.tar.gz
    - PULL_REQUEST_ID=$TRAVIS_PULL_REQUEST

jobs:
  include:
    - stage: test
      script: .travis/rspec
    - stage: stylistic
      script: bundle exec pronto run -f github_status -c origin/master --exit-code
    - stage: docs
      script: bundle exec yard
