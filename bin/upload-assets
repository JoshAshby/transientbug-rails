#!/bin/bash
set -ev

export DO_SPACES_ENDPOINT="https://nyc3.digitaloceanspaces.com"
export CURRENT_DATE=$(date -u "+%FT%H%M%S")
export PACKAGE="package-${CURRENT_DATE}.tar.gz"

echo "Building package ${PACKAGE}"
tar -zcvf "${PACKAGE}" public doc

echo "Uploading ${PACKAGE} to DO space"
aws s3 cp ${PACKAGE} "s3://transientbug-assets/" --endpoint ${DO_SPACES_ENDPOINT}
aws s3 cp ${PACKAGE} "s3://transientbug-assets/current_package.tar.gz" --endpoint ${DO_SPACES_ENDPOINT}
